<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Vibe 5.0 - Hiro's Calendar</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f8fafc; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 1. 使う道具を準備する
        const { useState, useEffect, useMemo } = React;

        // 2. メインのプログラム (Habit Vibe 5.0)
        const HabitTracker = () => {
            // --- 状態管理 (データの保存場所) ---
            const [dailyData, setDailyData] = useState({ 
                greenEx: 0, meditation: 0, coldWater: 0, pages: 0, 
                books: 0, cooking: 0, bento: 0, hiit: 0 
            });
            const [history, setHistory] = useState([]);
            const [selectedItem, setSelectedItem] = useState(null);
            
            const currentMonth = new Date().toISOString().slice(0, 7);

            // ローカルストレージからデータを読み込む
            useEffect(() => {
                const savedData = localStorage.getItem('habit-v5-data');
                if (savedData) setHistory(JSON.parse(savedData));
            }, []);

            // --- データ集計ロジック ---
            const allMonthlyStats = useMemo(() => {
                return history.reduce((acc, curr) => {
                    const m = curr.month;
                    if (!acc[m]) acc[m] = { greenEx: 0, meditation: 0, coldWater: 0, pages: 0, books: 0, cooking: 0, bento: 0, hiit: 0 };
                    Object.keys(acc[m]).forEach(key => { acc[m][key] += (curr[key] || 0); });
                    return acc;
                }, {});
            }, [history]);

            const personalBests = useMemo(() => {
                const months = Object.values(allMonthlyStats);
                const keys = ['greenEx', 'meditation', 'coldWater', 'pages', 'cooking', 'bento', 'hiit'];
                if (months.length === 0) return keys.reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
                return keys.reduce((acc, key) => ({
                    ...acc,
                    [key]: Math.max(...months.map(m => m[key] || 0), 0)
                }), {});
            }, [allMonthlyStats]);

            // 保存ボタンの処理
            const handleSave = () => {
                const today = new Date().toISOString().split('T')[0];
                const newData = { date: today, month: today.slice(0, 7), ...dailyData };
                const updatedHistory = [...history.filter(item => item.date !== today), newData];
                
                setHistory(updatedHistory);
                localStorage.setItem('habit-v5-data', JSON.stringify(updatedHistory));
                alert("今日の成果を刻みました！ナイスバイブス！");
                
                // 入力欄をリセット
                setDailyData({ greenEx: 0, meditation: 0, coldWater: 0, pages: 0, books: 0, cooking: 0, bento: 0, hiit: 0 });
            };

            const habitConfigs = {
                hiit: { label: 'HIIT', unit: '分', color: 'bg-red-500', icon: 'Zap' },
                greenEx: { label: 'グリーンEX', unit: '分', color: 'bg-emerald-500', icon: 'TreePine' },
                meditation: { label: '瞑想', unit: '分', color: 'bg-purple-500', icon: 'Flower2' },
                pages: { label: '読書', unit: '頁', color: 'bg-orange-500', icon: 'BookOpen' },
                coldWater: { label: '冷水', unit: '回', color: 'bg-blue-500', icon: 'Droplets' },
                cooking: { label: '料理', unit: '回', color: 'bg-rose-500', icon: 'Utensils' },
                bento: { label: 'お弁当', unit: '回', color: 'bg-amber-500', icon: 'Box' }
            };

            return (
                <div className="max-w-md mx-auto p-4 font-sans">
                    <h1 className="text-2xl font-bold mb-4 text-slate-800">Habit Vibe 5.0</h1>
                    <p className="text-sm text-slate-500 mb-6">{currentMonth.replace('-', '/')} status</p>

                    <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 mb-6">
                        <h2 className="text-lg font-bold mb-4">Quick Record</h2>
                        <div className="space-y-6">
                            {Object.entries(habitConfigs).map(([key, config]) => (
                                <div key={key}>
                                    <p className="text-sm font-medium mb-2">{config.label}</p>
                                    <div className="flex gap-2">
                                        {[2, 4, 6, 8].map(num => (
                                            <button 
                                                key={num}
                                                onClick={() => setDailyData(prev => ({ ...prev, [key]: prev[key] + num }))}
                                                className={`flex-1 py-2 rounded-xl text-sm font-bold shadow-sm border transition-all active:scale-95 ${config.color} text-white`}
                                            >
                                                +{num}
                                            </button>
                                        ))}
                                    </div>
                                    <p className="text-right text-xs mt-1 text-slate-400">現在: {dailyData[key]}{config.unit}</p>
                                </div>
                            ))}
                        </div>
                        <button 
                            onClick={handleSave}
                            className="w-full mt-8 bg-slate-800 text-white py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-transform"
                        >
                            今日の記録を保存する
                        </button>
                    </div>

                    <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
                        <h2 className="text-lg font-bold mb-4">Monthly Best</h2>
                        <div className="grid grid-cols-2 gap-4">
                            {Object.entries(habitConfigs).map(([key, config]) => (
                                <div key={key} className="bg-slate-50 p-3 rounded-2xl text-center">
                                    <p className="text-xs text-slate-500">{config.label}</p>
                                    <p className="text-xl font-black text-slate-800">{personalBests[key] || 0}<span className="text-xs ml-1 font-normal">{config.unit}</span></p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. 画面に表示させる命令
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HabitTracker />);
    </script>
</body>
</html>
